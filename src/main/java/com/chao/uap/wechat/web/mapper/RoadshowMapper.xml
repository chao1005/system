<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hyetec.uap.wechat.mapper.RoadshowMapper" >
  <!--
  Copyright (c) 2017 by Hyetec  Corporation all right reserved.
  2017年11月20日 11:09
  -->
  <resultMap id="BaseResultMap" type="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="pk_id" property="pkId" jdbcType="BIGINT" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="brief" property="brief" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="body" property="body" jdbcType="BIGINT" />
    <result column="validate_code" property="validateCode" jdbcType="VARCHAR" />
    <result column="video" property="video" jdbcType="VARCHAR" />
    <result column="aduitor_status" property="aduitorStatus" jdbcType="BIGINT" />
    <result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
    <result column="end_time" property="endTime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="creator" property="creator" jdbcType="BIGINT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="chatroomid" property="chatroomid" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    pk_id, name, brief, content, body, validate_code, video, aduitor_status, start_time, end_time,
    status, creator, create_time,chatroomid
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from f_roadshow
    where pk_id = #{pkId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from f_roadshow
    where pk_id = #{pkId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="pkId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into f_roadshow (name, brief, content, 
      body, validate_code, video, 
      aduitor_status, start_time, status, 
      creator, create_time,chatroomid)
    values (#{name,jdbcType=VARCHAR}, #{brief,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, 
      #{body,jdbcType=BIGINT}, #{validateCode,jdbcType=VARCHAR}, #{video,jdbcType=VARCHAR}, 
      #{aduitorStatus,jdbcType=BIGINT}, #{startTime,jdbcType=TIMESTAMP},#{endTime,jdbcType=TIMESTAMP}, #{status,jdbcType=INTEGER}, 
      #{creator,jdbcType=BIGINT}, #{createTime,jdbcType=TIMESTAMP}, 
      #{chatroomid,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="pkId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into f_roadshow
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        name,
      </if>
      <if test="brief != null" >
        brief,
      </if>
      <if test="content != null" >
        content,
      </if>
      <if test="body != null" >
        body,
      </if>
      <if test="validateCode != null" >
        validate_code,
      </if>
      <if test="video != null" >
        video,
      </if>
      <if test="aduitorStatus != null" >
        aduitor_status,
      </if>
      <if test="startTime != null" >
        start_time,
      </if>
      <if test="endTime != null" >
        end_time,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="chatroomid != null" >
        chatroomid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="brief != null" >
        #{brief,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="body != null" >
        #{body,jdbcType=BIGINT},
      </if>
      <if test="validateCode != null" >
        #{validateCode,jdbcType=VARCHAR},
      </if>
      <if test="video != null" >
        #{video,jdbcType=VARCHAR},
      </if>
      <if test="aduitorStatus != null" >
        #{aduitorStatus,jdbcType=BIGINT},
      </if>
      <if test="startTime != null" >
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=BIGINT},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="chatroomid != null" >
        #{chatroomid,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update f_roadshow
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="brief != null" >
        brief = #{brief,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="body != null" >
        body = #{body,jdbcType=BIGINT},
      </if>
      <if test="validateCode != null" >
        validate_code = #{validateCode,jdbcType=VARCHAR},
      </if>
      <if test="video != null" >
        video = #{video,jdbcType=VARCHAR},
      </if>
      <if test="aduitorStatus != null" >
        aduitor_status = #{aduitorStatus,jdbcType=BIGINT},
      </if>
      <if test="startTime != null" >
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        end_time = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=BIGINT},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="chatroomid != null" >
        chatroomid = #{chatroomid,jdbcType=BIGINT},
      </if>
    </set>
    where pk_id = #{pkId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update f_roadshow
    set name = #{name,jdbcType=VARCHAR},
      brief = #{brief,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      body = #{body,jdbcType=BIGINT},
      validate_code = #{validateCode,jdbcType=VARCHAR},
      video = #{video,jdbcType=VARCHAR},
      aduitor_status = #{aduitorStatus,jdbcType=BIGINT},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      end_time = #{endTime,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=INTEGER},
      creator = #{creator,jdbcType=BIGINT},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      chatroomid = #{chatroomid,jdbcType=BIGINT}
    where pk_id = #{pkId,jdbcType=BIGINT}
  </update>
  <cache type="org.mybatis.caches.ehcache.EhcacheCache" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
  </cache>
  <resultMap id="AliasResultMap" type="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="F_ROADSHOW_PK_ID" property="pkId" jdbcType="BIGINT" />
    <result column="F_ROADSHOW_NAME" property="name" jdbcType="VARCHAR" />
    <result column="F_ROADSHOW_BRIEF" property="brief" jdbcType="VARCHAR" />
    <result column="F_ROADSHOW_CONTENT" property="content" jdbcType="VARCHAR" />
    <result column="F_ROADSHOW_BODY" property="body" jdbcType="BIGINT" />
    <result column="F_ROADSHOW_VALIDATE_CODE" property="validateCode" jdbcType="VARCHAR" />
    <result column="F_ROADSHOW_VIDEO" property="video" jdbcType="VARCHAR" />
    <result column="F_ROADSHOW_ADUITOR_STATUS" property="aduitorStatus" jdbcType="BIGINT" />
    <result column="F_ROADSHOW_START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="F_ROADSHOW_END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="F_ROADSHOW_STATUS" property="status" jdbcType="INTEGER" />
    <result column="F_ROADSHOW_CREATOR" property="creator" jdbcType="BIGINT" />
    <result column="F_ROADSHOW_CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="F_ROADSHOW_CHATROOMID" property="chatroomid" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Alias_Column_List" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    F_ROADSHOW.PK_ID			AS	F_ROADSHOW_PK_ID,
	F_ROADSHOW.NAME				AS	F_ROADSHOW_NAME,
	F_ROADSHOW.BRIEF			AS	F_ROADSHOW_BRIEF,
	F_ROADSHOW.CONTENT			AS	F_ROADSHOW_CONTENT,
	F_ROADSHOW.BODY				AS	F_ROADSHOW_BODY,
	F_ROADSHOW.VALIDATE_CODE	AS	F_ROADSHOW_VALIDATE_CODE,
	F_ROADSHOW.VIDEO			AS	F_ROADSHOW_VIDEO,
	F_ROADSHOW.ADUITOR_STATUS	AS	F_ROADSHOW_ADUITOR_STATUS,
	F_ROADSHOW.START_TIME		AS	F_ROADSHOW_START_TIME,
	F_ROADSHOW.END_TIME	    	AS	F_ROADSHOW_END_TIME,
	F_ROADSHOW.STATUS			AS	F_ROADSHOW_STATUS,
	F_ROADSHOW.CREATOR			AS	F_ROADSHOW_CREATOR,
	F_ROADSHOW.CREATE_TIME		AS	F_ROADSHOW_CREATE_TIME,
	F_ROADSHOW.CHATROOMID       AS  F_ROADSHOW_CHATROOMID
  </sql>
  <!--
      以上由华源格林统一开发平台代码生成器自动生成，请在下方添加自定义的sql。 
  -->
  
  <select id="selectAll" resultType="com.hyetec.uap.wechat.model.Roadshow" parameterType="com.hyetec.uap.wechat.vo.RoadshowVo" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    a.pk_id pkId, a.name name , a.brief brief, a.content content, b.name bodyName, a.validate_code validateCode, a.video video,
     a.aduitor_status aduitorStatus, a.start_time startTime, a.end_time endTime,
    a.status status, a.creator creator, a.create_time createTime,a.chatroomid chatroomId
    from f_roadshow a
    left join f_enterprise b on b.pk_id = a.body
    <where>
    	<if test="roadshow != null">
    		<if test="roadshow.name != null and roadshow.name != ''" >
    			and a.name like concat('%',#{roadshow.name},'%')
    		</if>
    	</if>
    	and a.status = 0
    </where>
  </select>
  
  
  <select id="selectAllw" resultType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   select a.pk_id pkId,a.`name` name,b.`name` enterpriseName ,a.start_time startTime ,a.end_time endTime ,
   c.img enterpriseImg  ,a.validate_code validateCode  from f_roadshow a 
	LEFT JOIN f_enterprise b ON a.body=b.pk_id 
	LEFT JOIN f_user c ON b.user_id=c.pk_id
	where a.status = 0   
	AND DATE_FORMAT(a.end_time,'%Y-%c-%d %h:%i:%s') &gt; DATE_FORMAT(SYSDATE(),'%Y-%c-%d %h:%i:%s')
	 or  ISNULL(a.end_time)
	  </select>
  
  <select id="selectAllwMy" resultType="com.hyetec.uap.wechat.model.Roadshow" parameterType="java.lang.Long">
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   select a.pk_id pkId,a.`name` name,b.`name` enterpriseName ,a.start_time startTime ,
   c.img enterpriseImg  ,a.validate_code validateCode , 1 `status` from f_roadshow a 
	LEFT JOIN f_enterprise b ON a.body=b.pk_id 
	LEFT JOIN f_user c ON b.user_id=c.pk_id
  LEFT JOIN f_roadshow_person e ON e.roadshow_id = a.pk_id
	where a.status = 0  and e.user_id = #{userId,jdbcType=BIGINT} 
	  AND DATE_FORMAT(a.end_time,'%Y-%c-%d %h:%i:%s') &lt;  DATE_FORMAT(SYSDATE(),'%Y-%c-%d %h:%i:%s')
  </select>
  
   <update id="delByPkId"  parameterType="java.lang.Long" >
    update f_roadshow
    set  status = 1
    where pk_id = #{id,jdbcType=BIGINT} and status = 0 
  </update>
  
  <select id="checkName" resultType="java.lang.Integer" parameterType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select  count(*) from f_roadshow
    <where>
    	<if test="name != null and name != ''" >
    			and name = #{name}
    	</if>
    	<if test="pkId != null and pkId != ''" >
    			and pk_id != #{pkId}
    	</if>
    </where>
  </select>
   
  <select id="selectStatistics" resultType="com.hyetec.uap.wechat.model.Roadshow" parameterType="com.hyetec.uap.wechat.vo.RoadshowVo" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select a.pk_id  pkId, a.name  name,
   a.start_time startTime,
a.end_time endTime,
a.`status`  status,
(SELECT count(1) from f_chat_room_person p  where p.chat_room_id=a.chatroomid )
 chatNum
from f_roadshow a
    <where>
    	<if test="roadshow != null">
    		<if test="roadshow.name != null and roadshow.name != ''" >
    			and a.name like concat('%',#{roadshow.name},'%')
    		</if>
    	</if>
    	and a.status = 0
    </where>
  </select>
  
  <select id="selectAllTj" resultType="com.hyetec.uap.wechat.model.Roadshow" >
    <!--
      WARNING - @hyetec
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select a.name  name,
   a.start_time startTime,
a.end_time endTime,
a.`status`  status,
(SELECT count(1) from f_chat_room_person p  where p.chat_room_id=a.chatroomid )
 chatNum
from f_roadshow a
    <where>
    	 a.status = 0
    </where>
  </select>
</mapper>




